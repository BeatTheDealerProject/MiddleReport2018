\section{シミュレータ結果まとめ}
シュミレーターで10万回ブラックジャックを行った結果を表1に示す。
\begin{table}[H]
 \begin{center}
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
     & \multicolumn{3}{c|}{デック数無限} & \multicolumn{3}{c|}{デック数1} \\
    \cline{2-7} & 勝ち & 負け & 引き分け & 勝ち & 負け & 引き分け \\
    \hline ベーシックストラテジー & 42746 & 48635 & 8619 & 43111 & 48654 & 8235 \\
    \hline ベーシックストラテジー改1 & 42583 & 48782 & 8635 & 42923 & 48909 & 8168 \\
    \hline ベーシックストラテジー改2 & 42223 & 49079 & 8698 & 42955 & 48689 & 8356 \\
    \hline 15以上 & 42392 & 49458 & 8150 & 42063 & 50027 & 7910 \\
    \hline 16以上 & 41410 & 49506 & 9084 & 41580 & 49672 & 8748 \\
    \hline 17以上 & 40870 & 49400 & 9730 & 40974 & 49630 & 9396 \\
    \hline 18以上 & 39291 & 52587 & 8122 & 42071 & 49872 & 8057 \\
    \hline
  \end{tabular}
 \end{center}
 \caption{デック数と各戦略での勝利、負け、引き分け}
\end{table}
今回シミュレータをそれぞれの戦略で10万回ずつ実行し、その結果を勝ち、負け、引き分けの3種類に分けて、表にまとめた。縦軸はデックの数とそれに対応する勝敗とし、横軸は戦略ごとに分けている。例えば、ベーシックストラテジーでデック数1の場合を見ると勝ちが43111で負けが48654で引き分けが8235となっている。またデック数1の勝ちを全体でみると最も多いことが分かる。\\
全体として勝ちの数は4万回前後に収まっており、負けの数は５万回前後に収まっている。基本的に負けの数のほうが多いことが分かる。デック数で比べると、ほとんどの戦略でデック数１の場合のほうが勝ちの数が多いということが発見される。また、デック数に関係なく、勝ちの数はベーシックストラテジーが一番多いということが分かる。

\section{検定}
先ほどのシミュレータの結果からベーシックストラテジーが最も勝率が高いというを確かめめるために、戦略の間の勝率に有意な差があるかどうかを確かめたい。また、デック数によって勝率が変化するということも確かめために、デック数の違いによって戦略の勝率に有意な差があるかも確かめたい。確かめるために検定を行う。
\section{カイ2乗検定の独立性の検定}
勝率に有意な差があるかどうかを確かめるためカイ2乗検定の独立性の検定を使用する。カイ2乗検定ではカイ2乗値を用いて検定を行う。カイ2乗値は下の式で計算を行う。
\begin{equation} カイ2乗 = \sum{ \frac{(実現度数 - 理論度数)^2}{理論度数}} \end{equation}
実現度数とは実際に出た度数のことで、理論度数は理想としてでる度数のことである。実現度数はシミュレータの結果から参照し、理論度数はシミュレータの結果から計算する。
理論度数は以下の式で計算される。
\begin{equation} 理論度数 =  行の合計 \frac{列の合計}{すべての合計} \end{equation}
\section{戦略間の勝率}
カイ2乗検定を行うためにシミュレータの結果の表を変形する。
\begin{table}[H]
 \begin{center}
  \begin{tabular}{|c|c|c|c|}
    \hline
      & 勝ち & 勝ち以外(負けと引き分け) & 合計 \\
    \hline ベーシックストラテジー (実現度数)& 42746 & 57254 & 100000 \\
             ベーシックストラテジー (理論度数)& 41645 & 58355 &  \\
    \hline ベーシックストラテジー改1 (実現度数)& 42583 & 57417 & 100000 \\
             ベーシックストラテジー改1 (理論度数)& 41645 & 58355 &  \\
    \hline ベーシックストラテジー改2 (実現度数)& 42223 & 57777 & 100000 \\
              ベーシックストラテジー改2 (理論度数)& 41645 & 58355 &  \\
    \hline 15以上 (実現度数)& 42392 & 57608 & 100000 \\
             15以上 (理論度数)& 41645 & 58355 & 　\\
    \hline 16以上 (実現度数)& 41410 & 58590 & 100000 \\
             16以上 (理論度数)& 41645 & 58355 & 　\\
    \hline 17以上 (実現度数)& 40870 & 59130 & 100000 \\
             17以上 (理論度数)& 41645 & 58355 & 　\\
    \hline 18以上 (実現度数)& 39291 & 60709 & 100000 \\
             18以上 (理論度数)& 41645 & 58355 & 　\\
    \hline  合計 & 291515 & 408485 & 700000 \\
    \hline
  \end{tabular}
 \end{center}
 \caption{デック数無限の場合}
\end{table}
\begin{table}[H]
 \begin{center}
  \begin{tabular}{|c|c|c|c|}
    \hline
      & 勝ち & 勝ち以外(負けと引き分け) & 合計 \\
    \hline ベーシックストラテジー (実現度数)& 43111 & 56889 & 100000 \\
             ベーシックストラテジー (理論度数)& 42240 & 57760 &  \\
    \hline ベーシックストラテジー改1 (実現度数)& 42923 & 57077 & 100000 \\
             ベーシックストラテジー改1 (理論度数)& 42240 & 57760 &  \\
    \hline ベーシックストラテジー改2 (実現度数)& 42955 & 57045 & 100000 \\
              ベーシックストラテジー改2 (理論度数)& 42240 & 57760 &  \\
    \hline 15以上 (実現度数)& 42063 & 57937 & 100000 \\
             15以上 (理論度数)& 42240 & 57760 & 　\\
    \hline 16以上 (実現度数)& 41580 & 58420 & 100000 \\
             16以上 (理論度数)& 42240 & 57760 & 　\\
    \hline 17以上 (実現度数)& 40974 & 59026 & 100000 \\
             17以上 (理論度数)& 42240 & 57760 & 　\\
    \hline 18以上 (実現度数)& 42071 & 57045 & 100000 \\
             18以上 (理論度数)& 42240 & 57760 & 　\\
    \hline  合計 & 295677 & 404323 & 700000 \\
    \hline
  \end{tabular}
 \end{center}
 \caption{デック数1の場合}
\end{table}
\clearpage
シミュレーション結果の表を改変したもので、負けと引き分けをまとめ、縦軸と横軸の合計をつて、理論度数を計算して付け加えたものである。
カイ2乗検定を行う前に帰無仮説、対立仮説と優位水準を定める。\\
帰無仮説:戦略間の勝率に有意な差がない\\
対立仮説:戦略間の勝率に有意な差がある\\
優位水準を5％として、カイ2乗検定を行う。\\
自由度は(行の数-1)(列の数-1)で求められるので、(7-1)(2-1)で自由度6となる。自由度6かつ優位水準5％の時、棄却値は12.96となる。この棄却値よりもカイ2乗値が大きい場合、帰無仮説を棄却して対立仮説が採択される。\\
デック数無限の場合、カイ2乗値は377.8012となり、カイ2乗値が12.96より大きい377.8012となるため、帰無仮説を棄却する。つまり、デック数無限の場合、勝率に有意な差が存在する。\\
デック数1の場合、カイ2乗値は127.8811となり、カイ2乗値が12.96より大きい127.8811となるため帰無仮説を棄却する。つまり、デック数1の場合、勝率に有意な差が存在する。
\section{デック数による勝率}
カイ2乗検定を行うための表を作成する。まずがベーシックストラテジーでの表を作成する。
\begin{table}[H]
 \begin{center}
  \begin{tabular}{|c|c|c|c|}
    \hline
      & 勝ち & 勝ち以外(負けと引き分け) & 合計 \\
    \hline デック数無限のベーシックストラテジー (実現度数)& 42798 & 57202 & 100000 \\
            デック数無限のベーシックストラテジー (理論度数)& 42955 & 57046 &  \\
    \hline デック数1のベーシックストラテジー (実現度数)& 43111 & 56889 & 100000 \\
            デック数1のベーシックストラテジー (理論度数)& 42955 & 57046 &  \\
    \hline  合計 & 85909 & 114991 & 200000 \\
    \hline
  \end{tabular}
 \end{center}
 \caption{デック数ごとのベーシックストラテジー}
\end{table}
７つの戦略のうち１つ対象にして、デック数無限とデック数1の場合の勝ちと勝ち以外の２つを載せ、それに合計と理論度数を付け足した表である。縦軸は勝敗で横軸はデック数での戦略である。
シミュレータの結果からこのような表を７つの戦略で作る。
カイ2乗検定を行う前に帰無仮説、対立仮説と優位水準を定める。\\
帰無仮説:デック数1と無限の間に勝率に有意な差がない\\
対立仮説:デック数1と無限の間勝率に有意な差がある\\
優位水準を5％として、カイ2乗検定を行う。\\
自由度は1となり、優位水準5％なので、棄却値は3.84となる。この棄却値よりもカイ2乗値が大きい場合、帰無仮説を棄却して対立仮説が採択される。\\
ベーシックストラテジーの場合、カイ2乗値は1.0665となり、1.0665<3.84より帰無仮説を棄却しない。つまり、ベーシックストラテジーでデック数が1と無限では勝率に有意な差はない。
これをそれぞれベーシックストラテジー改1、ベーシックストラテジー改2、15以上、16以上、17以上、18以上について同じように行う。
すべてをまとめると、ベーシックストラテジー改1から順にカイ2乗値は4.6112、3.0753、2.2164、0.5952、0.2237、160.1305となった。この中で棄却値を超えたの
はベーシックストラテジー改1と18以上の場合である。ベーシックストラテジー改2、15以上、16以上と17以上の場合、デック数が1と無限では勝率に有意な差はない、
ベーシックストラテジー改1と18以上の場合、デック数が1と無限では勝率に有意な差はあるという結果である。
\section{残差分析}
カイ2乗検定によって各戦略間の勝率に有意な差が存在することが判明した。しかし、どこに有意な差が存在するのかが分からない。そのためさらに検定を行いどの戦略
に有意な差が存在するのかを探す。有意な差がどこに存在するのかを発見するため残差分析を行う。残差分析では調整済み標準化残差を算出し、調整済み標準化残差が1.96
より大きい場合と-1.96より小さい場合に有意な差があると分かる。調整済み標準化残差は以下の式で計算される。
\begin{equation} 調整済み標準化残差 =  \frac{\frac{実現度数 - 理論度数}{\sqrt{理論度数}}}{(1-行比率)(1-列比率)} \end{equation}
調整済み標準化残差をそれぞれ出したものを表でまとめる。
\begin{table}[H]
 \begin{center}
  \begin{tabular}{|c|c|c|c|c|}
    \hline
     & \multicolumn{2}{c|}{デック数無限} & \multicolumn{2}{c|}{デック数1} \\
    \cline{2-5} & 勝ち & 勝ち以外 & 勝ち & 勝ち以外 \\
    \hline ベーシックストラテジー & 7.63 & -7.63 & 6.02 & -6.02  \\
    \hline ベーシックストラテジー改1 & 6.50 & -6.50 & 4.73 & -4.73  \\
    \hline ベーシックストラテジー改2 & 4.00 & -4.00 & 4.95 & -4.95  \\
    \hline 15以上 & 5.18 & -5.18 & -1.22 & 1.22  \\
    \hline 16以上 & -1.63 & 1.63 & -4.56 & 4.56  \\
    \hline 17以上 & -5.37 & 5.37 & -8.75 & 8.75  \\
    \hline 18以上 & -16.31 & 16.31 & -1.17 & 1.17  \\
    \hline
  \end{tabular}
 \end{center}
 \caption{調整済み標準化残差}
\end{table}
この表ではそれぞれの戦略でのデック数無限と1の場合の勝ちと勝ち以外の調整済み標準化残差を示している。縦軸がデック数とデック数に対応した勝ちと勝ち以外の項目で、横軸がそれぞれの戦略に分かれている。この表の1.92以上と-1.92以下が有意な差とある判断できる。例えば、デック数無限の勝ちでベーシックストラテジーをみると値が7.63になっており、1.92以上なのでベーシックストラテジーの勝ちの数はほかの戦略の勝ちより優位に多かったということが分かります。\\
デック数無限を見ると、ベーシックストラテジーやベーシックストラテジー改1、ベーシックストラテジー改2、15以上になるまでヒットする戦略での勝ちの項目が1.96を超えておりほかの戦略より優位に多いことが分かる。逆に17以上までヒットする戦略と18以上までヒットする戦略は勝ちの項目が-1.96を下回ったのでほかの戦略より有意に少ない。
デック数1を見ると、ベーシックストラテジーやベーシックストラテジー改1、ベーシックストラテジー改2の勝ちの項目が1.96を超えておりほかの戦略より優位に多いことが分かる。逆に116以上までヒットする戦略と17以上までヒットする戦略は勝ちの項目が-1.96を下回ったのでほかの戦略より有意に少ない。
ベーシックストラテジー、ベーシックストラテジー改1、ベーシックストラテジー改2の3つはデック数に関係なく勝ちが有意に多いことが分かる。逆に、17以上までヒットする戦略はデック数にかかわりなく勝ちが有意に少ないことが分かる。
\section{多重比較}
残差分析によって全戦略のどこに有意な差があるかが分かった。しかし、戦略と戦略の間に有意な差があるかはわからない。そのため、多重比較を行い、戦略間に有意な差があるかどうかを確認する。\\
fisherの正確確率検定を用いて、戦略間のp値をすべて算出し、p値をholm法で調整を施す。p値が0.05以下の場合、有意な差がある。p値が0.05より大きい場合、有意な差がないとする。それを表にまとめた。
\begin{table}[H]
 \begin{center}
 \small
 \scalebox{0.8}[1.0]{
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline & ベーシックストラテジー & ベーシックストラテジー改1 & ベーシックストラテジー改2 & 15以上 & 16以上 & 17以上 \\
    \hline ベーシックストラテジー改1 勝率差 & 0.1 &  &  &  &  &   \\
    ベーシックストラテジー改1 p値 & 1.000 &  &  &  &  &    \\
    \hline ベーシックストラテジー改2 勝率差 & 0.5 & 0.4 & & & &  \\
    ベーシックストラテジー改2 p値 & 0.109 & 0.522 & & & &   \\
    \hline 15以上 勝率差 & 0.3 & 0.2 & -0.2 & & &   \\
    15以上 p値 & 0.522 & 1.000 & 1.000 & & &  \\
    \hline 16以上 勝率差 & 1.3 & 1.2 & 0.8 & 1.0 & &  \\
    16以上 p値 & 0 & 0 & 0.002 & 0 & &  \\
    \hline 17以上 勝率差 & 1.8 & 1.8 & 1.3 & 1.5 & 0.5 &  \\
    17以上 p値 & 0 & 0 & 0 & 0 & 0 & \\
    \hline 18以上 勝率差 & 3.4 & 3.3 & 2.9 & 3.1 & 2.1 & 1.6  \\
    18以上 p値 & 0 & 0 & 0 & 0 & 0 & 0  \\
    \hline
  \end{tabular}
 }
 \end{center}
 \caption{デック数無限の多重比較}
\end{table}
\begin{table}[H]
 \begin{center}
 \small
 \scalebox{0.8}[1.0]{
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline & ベーシックストラテジー & ベーシックストラテジー改1 & ベーシックストラテジー改2 & 15以上 & 16以上 & 17以上 \\
    \hline ベーシックストラテジー改1 勝率差 & 0.2 &  &  &  &  &   \\
    ベーシックストラテジー改1 p値 & 1.000 &  &  &  &  &    \\
    \hline ベーシックストラテジー改2 勝率差 & 0.1 & -0.1 & & & &  \\
    ベーシックストラテジー改2 p値 & 1.000 & 1.000 & & & &   \\
    \hline 15以上 勝率差 & 1.0 & 0.8 & 0.9 & & &   \\
    15以上 p値 & 0 & 1.001 & 0.001 & & &  \\
    \hline 16以上 勝率差 & 1.5 & 1.3 & 1.4 & 0.5 & &  \\
    16以上 p値 & 0 & 0 & 0 & 0.158 & &  \\
    \hline 17以上 勝率差 & 2.1 & 2.1 & 2.0 & 1.1 & 0.6 &  \\
    17以上 p値 & 0 & 0 & 0 & 0 & 0.042 & \\
    \hline 18以上 勝率差 & 1.0 & 1.0 & 0.9 & 0 & -0.5 & 1.1  \\
    18以上 p値 & 0 & 0.001 & 0.001 & 1.000 & 0.158 & 0  \\
    \hline
  \end{tabular}
 }
 \end{center}
 \caption{デック数1の多重比較}
\end{table}
表にはそれぞれの戦略を比較した場合の勝率差とp値の2つの項目で構成されており、勝率差がプラスの場合、縦軸の戦略のほう勝率が良いことになる。例えば、縦軸がベーシックストラテジー、横軸が15以上になるまでヒットする戦略の部分を見ると、勝率が1.0でp値が0となっている。p値が0.05より小さいためベーシックストラテジーと15以上になるまでヒットする戦略の間の勝率に有意な差が存在することになり、ベーシックストラテジーのほうが勝率が1.0高いということになる。
表により、デック数無限の場合、ベーシックストラテジー、ベーシックストラテジー改1、ベーシックストラテジー改2と15以上になるまでヒットする戦略の3つで勝率に有意な差がない。16以上までヒットする戦略と17以上までヒットする戦略の2つは勝率に有意な差はない。それ以外には勝率に有意な差が存在した。これらを勝率の高い順に戦略を並べると、ベーシックストラテジーなどの戦略、16と17以上までヒットする戦略、18以上までヒットする戦略となる。デック数1の場合はベーシックストラテジー、ベーシックストラテジー改1とベーシックストラテジー改2の3つに勝率に有意な差が存在しない。15以上になるまでヒットする戦略、16以上になるまでヒットする戦略と18以上になるまでヒットする戦略の3つに有意な差が存在しない。これらを勝率の高い順に戦略を並べると、ベーシックストラテジーとベーシックストラテジー改1ベーシックストラテジー改2の戦略、15と16と18以上になるまでヒットする戦略、17以上までヒットする戦略となる。

